<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Fight-no-Flight</title>

  <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="css/styles.css">
  <!-- <link rel="stylesheet" href="css/pygment_trac.css"> -->
  <!-- <link rel="stylesheet" href="css/tomorrow-night.css"> -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.2/underscore-min.js"></script>
  <script src="js/vendor/backbone/backbone.js"></script>
  <script src="js/vendor/backbone/backbone-indexeddb.js"></script>
  <script src="js/vendor/josh/history.js"></script>
  <script src="js/vendor/josh/killring.js"></script>
  <script src="js/vendor/josh/readline.js"></script>
  <script src="js/vendor/josh/input.js"></script>
  <script src="js/vendor/josh/shell.js"></script>
  <script src="js/vendor/jquery.parse.min.js  "></script>
  <script src="js/vendor/moment.min.js"></script>

  <script src="js/app.js"></script>
  <script src="js/airport.js"></script>
  <script src="js/provider.js"></script>
</head>
<body style="margin-left:10px;margin-top:10px">
  <h2>Fight-no-Flight</h2>  
<div id="shell-panel">
  <div>Type <code>help</code> or hit <code>TAB</code> for a list of commands.</div>
  <div id="flight-loading-airports">Loading Airports...</div>
  <div id="flight-loading-providers">Loading Providers...</div>
  <div id="shell-view"></div>
</div>
<a target="_new" href="https://github.com/sdether/josh.js">Using CLI library - Josh.js</a>

<script>
var history = new Josh.History({ key: 'fnf.history'});
var shell = Josh.Shell({history: history});

Airport.loadFromCSV(function(){
  $("#flight-loading-airports").text(""+Airport.count()+" airports loaded.");
});
Provider.loadFromCSV("data/provider1.txt", function() {
  $("#flight-loading-providers").text("Loading "+Provider.count()+" providers...");
});
Provider.loadFromCSV("data/provider2.txt", function() {
  $("#flight-loading-providers").text("Loading "+Provider.count()+" providers...");
});
Provider.loadFromCSV("data/provider3.txt", function() {
  $("#flight-loading-providers").text(""+Provider.count()+" providers loaded.");
});

shell.setCommandHandler("searchFlights", {
    exec: function(cmd, args, callback) {
        var arg = args[0] || '';
        var origin = findArgument("-o",args);
        var dest = findArgument("-d",args);
        var response;
        if (!origin || !dest) {
          response = "Missing required arguments:<BR>-o   Origin Airport Code<BR>   -d   Destination Airport Code<br/><br/>Example usage:<br/>$ searchFlights -o YYZ -d LAS<br/>";
        }
        else {
          response = "Searching for flights from '"+origin+"' to '"+dest+"'";
          var flights = Provider.flightsWithOrigin(origin);
          for (var i = flights.length - 1; i >= 0; i--) {
            var destinationCode = flights[i].get("Destination");
            if (destinationCode === dest) {              
              response  += "<br/>"
                        + flights[i].get("Origin")
                        + " --> " + destinationCode 
                        + " (" + flights[i].getOriginTime().format()
                        + " --> "
                        + flights[i].getDestinationTime().format()
                        + ") - "
                        + flights[i].flightTime() + " - "
                        + flights[i].get("Price")
                        + ")";
            }
          };
        }

        callback(response);
    }
});
shell.setCommandHandler("airport", {
    exec: function(cmd, args, callback) {
        callback("response");
    }
});

shell.activate();

function findArgument(option, args) {
  for (var i = args.length - 1; i >= 0; i--) {
    if (args[i] === option) {
      return args[i+1];
    }    
  }
  return false;
}

</script>
</body>
</html>